<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-slate-950 text-slate-100">
  <main class="max-w-5xl mx-auto p-4 sm:p-8">

    <!-- Header -->
    <header class="mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold">Admin Portal</h1>
      <p class="text-slate-300 mt-2">
        Manage employees, fix punches, and export hours.
      </p>
    </header>

    <!-- ================= ADMIN LOGIN ================= -->
    <section
      id="adminLoginCard"
      class="bg-slate-900/60 border border-slate-800 rounded-2xl p-5 sm:p-6 shadow-lg"
    >
      <h2 class="text-lg font-semibold">Admin Sign In</h2>

      <form id="adminLoginForm" class="mt-4 grid gap-3 max-w-md">
        <div>
          <label class="block text-sm text-slate-300" for="adminPassword">Admin Password</label>
          <input
            id="adminPassword"
            type="password"
            required
            class="mt-1 w-full rounded-xl bg-slate-950/60 border border-slate-800 px-4 py-3 outline-none focus:ring-2 focus:ring-indigo-500"
          />
        </div>

        <button
          type="submit"
          class="rounded-xl bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 px-4 py-3 font-semibold transition"
        >
          Sign In
        </button>

        <p id="adminLoginMsg" class="text-sm text-rose-300"></p>
      </form>
    </section>

    <!-- ================= ADMIN APP ================= -->
    <section id="adminApp" class="mt-6 grid gap-6 hidden">

      <!-- Status bar -->
      <div class="flex items-center justify-between gap-3">
        <p class="text-slate-300">
          Status:
          <span class="text-emerald-300 font-semibold">Signed in</span>
        </p>
        <button
          id="adminSignOutBtn"
          type="button"
          class="rounded-xl border border-slate-700 bg-slate-950/40 hover:bg-slate-950/70 px-4 py-2 font-medium transition"
        >
          Sign Out
        </button>
      </div>

      <!-- ================= ADD EMPLOYEE ================= -->
      <section class="bg-slate-900/60 border border-slate-800 rounded-2xl p-5 sm:p-6 shadow-lg">
        <h2 class="text-lg font-semibold">Add Employee</h2>

        <form id="addEmployeeForm" class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
          <div>
            <label class="block text-sm text-slate-300" for="newCode">Employee Code</label>
            <input
              id="newCode"
              type="text"
              required
              class="mt-1 w-full rounded-xl bg-slate-950/60 border border-slate-800 px-4 py-3"
            />
          </div>

          <div>
            <label class="block text-sm text-slate-300" for="newName">Full Name</label>
            <input
              id="newName"
              type="text"
              required
              class="mt-1 w-full rounded-xl bg-slate-950/60 border border-slate-800 px-4 py-3"
            />
          </div>

          <div>
            <label class="block text-sm text-slate-300" for="newPin">PIN</label>
            <input
              id="newPin"
              type="password"
              required
              class="mt-1 w-full rounded-xl bg-slate-950/60 border border-slate-800 px-4 py-3"
            />
          </div>

          <div class="sm:col-span-3">
            <button
              type="submit"
              class="rounded-xl bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-700 px-4 py-3 font-semibold transition"
            >
              Create Employee
            </button>
          </div>

          <p id="addEmployeeMsg" class="sm:col-span-3 text-sm text-rose-300"></p>
        </form>
      </section>

      <!-- ================= EMPLOYEES TABLE ================= -->
      <section class="bg-slate-900/60 border border-slate-800 rounded-2xl p-5 sm:p-6 shadow-lg">
        <div class="flex items-center justify-between gap-3">
          <h2 class="text-lg font-semibold">Employees</h2>
          <button
            id="refreshEmployeesBtn"
            type="button"
            class="rounded-xl border border-slate-700 bg-slate-950/40 hover:bg-slate-950/70 px-4 py-2 font-medium transition"
          >
            Refresh
          </button>
        </div>

        <div class="mt-4 overflow-x-auto">
          <table class="w-full text-sm">
            <thead class="text-slate-300">
              <tr class="border-b border-slate-800">
                <th class="text-left py-2 pr-3">Code</th>
                <th class="text-left py-2 pr-3">Name</th>
                <th class="text-left py-2 pr-3">Active</th>
                <th class="text-left py-2 pr-3">Actions</th>
              </tr>
            </thead>
            <tbody id="employeesTbody" class="text-slate-200"></tbody>
          </table>
        </div>

        <p id="employeesMsg" class="mt-3 text-sm text-rose-300"></p>
      </section>

      <!-- ================= FIX EMPLOYEE TIME ================= -->
      <!-- SAFETY: prevent implicit submits / navigation -->
      <section class="bg-slate-900/60 border border-slate-800 rounded-2xl p-5 sm:p-6 shadow-lg">
        <h2 class="text-lg font-semibold">Fix Employee Time</h2>
        <p class="text-slate-300 text-sm mt-1">
          Search by employee code or name, then fix missing punches for a specific date.
        </p>

        <form id="fixFormGuard" onsubmit="return false;">
          <!-- Search -->
          <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="sm:col-span-2">
              <label class="block text-sm text-slate-300" for="fixSearch">Search employee</label>
              <input
                id="fixSearch"
                type="text"
                placeholder="e.g. 12 or Mina"
                class="mt-1 w-full rounded-xl bg-slate-950/60 border border-slate-800 px-4 py-3"
              />
            </div>

            <div class="flex items-end gap-2">
              <button
                id="fixSearchBtn"
                type="button"
                class="w-full rounded-xl bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 px-4 py-3 font-semibold transition"
              >
                Search
              </button>
            </div>
          </div>

          <p id="fixMsg" class="mt-3 text-sm text-rose-300"></p>

          <!-- Multiple matches list -->
          <div id="fixResultsWrap" class="mt-3 hidden">
            <p class="text-xs text-slate-400 mb-2">Multiple matches — click the correct employee:</p>
            <div id="fixResultsList" class="flex flex-col gap-2"></div>
          </div>

          <!-- Selected employee + controls -->
          <div id="fixPanel" class="mt-5 hidden border-t border-slate-800 pt-5">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
              <div>
                <p class="text-slate-300 text-sm">Selected employee</p>
                <p id="fixSelected" class="text-lg font-semibold">—</p>
              </div>

              <button
                id="fixCancelBtn"
                type="button"
                class="rounded-xl border border-slate-700 bg-slate-950/40 hover:bg-slate-950/70 px-4 py-2 font-medium transition"
              >
                Cancel
              </button>
            </div>

            <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="block text-sm text-slate-300" for="fixDate">Date</label>
                <input
                  id="fixDate"
                  type="date"
                  class="mt-1 w-full rounded-xl bg-slate-950/60 border border-slate-800 px-4 py-3"
                />
              </div>

              <div class="flex items-end">
                <button
                  id="checkOpenBtn"
                  type="button"
                  class="w-full rounded-xl border border-slate-700 bg-slate-950/40 hover:bg-slate-950/70 px-4 py-3 font-semibold transition"
                >
                  Check Missing
                </button>
              </div>
            </div>

            <!-- Fix buttons -->
            <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
              <button id="fixInBtn" type="button"
                class="rounded-xl bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-700 px-4 py-3 font-semibold transition">
                Fix Punch IN
              </button>

              <button id="fixOutBtn" type="button"
                class="rounded-xl bg-rose-600 hover:bg-rose-500 active:bg-rose-700 px-4 py-3 font-semibold transition">
                Fix Punch OUT
              </button>

              <button id="fixMealStartBtn" type="button"
                class="rounded-xl bg-amber-600 hover:bg-amber-500 active:bg-amber-700 px-4 py-3 font-semibold transition">
                Fix Meal START
              </button>

              <button id="fixMealEndBtn" type="button"
                class="rounded-xl bg-amber-600 hover:bg-amber-500 active:bg-amber-700 px-4 py-3 font-semibold transition">
                Fix Meal END
              </button>

              <button id="fixPaid10StartBtn" type="button"
                class="rounded-xl bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 px-4 py-3 font-semibold transition">
                Fix Paid10 START
              </button>

              <button id="fixPaid10EndBtn" type="button"
                class="rounded-xl bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 px-4 py-3 font-semibold transition">
                Fix Paid10 END
              </button>
            </div>

            <!-- Fix Time Modal (inline) -->
            <div id="fixTimeModal" class="mt-4 hidden border border-slate-800 rounded-2xl p-4 bg-slate-950/40">
              <div class="flex items-center justify-between gap-3">
                <div>
                  <p class="text-slate-300 text-sm">Fix Action</p>
                  <p id="fixTimeTitle" class="text-lg font-semibold">—</p>
                  <p id="fixTimeInfo" class="text-sm text-slate-300 mt-1"></p>
                </div>

                <button
                  id="fixTimeCancelBtn"
                  type="button"
                  class="rounded-xl border border-slate-700 bg-slate-950/40 hover:bg-slate-950/70 px-4 py-2 font-medium transition"
                >
                  Cancel
                </button>
              </div>

              <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div>
                  <label class="block text-sm text-slate-300" for="fixTimeInput">Time</label>
                  <input
                    id="fixTimeInput"
                    type="time"
                    class="mt-1 w-full rounded-xl bg-slate-950/60 border border-slate-800 px-4 py-3"
                  />
                  <p class="text-slate-400 text-xs mt-1">Use 24-hour time (ex: 22:00 = 10:00 PM)</p>
                </div>

                <div class="flex items-end">
                  <button
                    id="fixTimeConfirmBtn"
                    type="button"
                    class="w-full rounded-xl bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-700 px-4 py-3 font-semibold transition"
                  >
                    Confirm Fix
                  </button>
                </div>
              </div>
            </div>

            <!-- Action / error messages for fixes -->
            <p id="fixActionMsg" class="mt-3 text-sm text-rose-300"></p>
          </div>
        </form>
      </section>

      <!-- ================= EXPORT ================= -->
      <section class="bg-slate-900/60 border border-slate-800 rounded-2xl p-5 sm:p-6 shadow-lg">
        <h2 class="text-lg font-semibold">Export Hours (Excel)</h2>
        <p class="text-slate-300 text-sm mt-1">Timezone: America/Los_Angeles</p>

        <form id="exportForm" class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
          <div>
            <label class="block text-sm text-slate-300">Start Date</label>
            <input
              id="exportStart"
              type="date"
              required
              class="mt-1 w-full rounded-xl bg-slate-950/60 border border-slate-800 px-4 py-3"
            />
          </div>

          <div>
            <label class="block text-sm text-slate-300">End Date</label>
            <input
              id="exportEnd"
              type="date"
              required
              class="mt-1 w-full rounded-xl bg-slate-950/60 border border-slate-800 px-4 py-3"
            />
          </div>

          <div class="flex items-end">
            <button
              id="downloadExcelBtn"
              type="submit"
              class="w-full rounded-xl bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 px-4 py-3 font-semibold transition"
            >
              Download Excel
            </button>
          </div>

          <p id="exportMsg" class="sm:col-span-3 text-sm text-rose-300"></p>
        </form>
      </section>

    </section>
  </main>

  <!-- ✅ Cache-busting so you stop running old admin.js -->
  <script src="admin.js?v=20260206_1"></script>
</body>
</html>
